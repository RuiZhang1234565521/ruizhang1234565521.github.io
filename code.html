<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <title>正在登陆</title>
    <style>
        @media screen and (min-width:400px) {body {width: 400px;}}
        @media screen and (max-width:400px) {body {width: 99%;}}
        body {margin: 0 auto;font-size: 14px;word-break: break-all;}
    </style>
</head>
<body>
    <div id="status">正在处理请求，请稍候...</div>
    <div id="info-content"></div>
</body>
</html>
<script>
    function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        return {
            code: params.get('code'),
            state: params.get('state')
        };
    }
    function processState(state, code) {
        let processedState = state.replace(/0d0/g, ".").replace(/0g0/g, "/").replace(/0m0/g, ":");
        if (processedState.indexOf("?") === -1) {processedState += "?";} 
        else {processedState += "&";}
        processedState += "code=" + encodeURIComponent(code) + "&del=";
        return processedState;
    }
    function processRequest() {
        const statusElement = document.getElementById('status');
        const infoContent = document.getElementById('info-content');
        
        try {
            const { code, state } = getUrlParams();
            if (!code || !state) {
                throw new Error('缺少必要的参数: code 或 state');
            }
            infoContent.innerHTML = `
                <div>获取到的参数:</div>
                <div>code: ${code || '未提供'}</div>
                <div>state: ${state || '未提供'}</div>
            `;
            statusElement.innerHTML = "正在处理参数...";
            const redirectUrl = processState(state, code);
            infoContent.innerHTML += `
                <div>处理后的URL:</div>
                <div>${redirectUrl}</div>
            `;
            statusElement.innerHTML = "处理完成，正在跳转...";
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 10);      
        } catch (error) {
            statusElement.innerHTML = `处理请求时出错: ${error.message}`;
        }
    }
    document.addEventListener('DOMContentLoaded', processRequest);
</script>
